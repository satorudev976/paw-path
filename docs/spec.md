# çŠ¬ã®æ•£æ­©è¨˜éŒ²ã‚¢ãƒ—ãƒª ä»•æ§˜æ›¸ï¼ˆspec.mdï¼‰

## 0. ã“ã®ä»•æ§˜æ›¸ã®å‰æï¼ˆAIå‘ã‘ï¼‰
ã“ã®ä»•æ§˜æ›¸ã¯ã€Œå®Œå…¨ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€ã§ã¯ãªãã€
å€‹äººé–‹ç™ºå‘ã‘ã®ã€Œã‚¯ãƒªãƒ¼ãƒ³ãªè²¬å‹™åˆ†é›¢ã€ã‚’å‰æã¨ã™ã‚‹ã€‚

- UI â†’ Context â†’ Service â†’ Repository ã®æ§‹æˆã‚’å®ˆã‚‹
- Context ã«æ¥­å‹™ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ›¸ã‹ãªã„
- ä¸æ˜ç‚¹ã¯å‹æ‰‹ã«è£œå®Œã›ãšã€è¨­è¨ˆæ¡ˆã‚’æç¤ºã™ã‚‹ã“ã¨

---

## 1. ã‚¢ãƒ—ãƒªæ¦‚è¦ï¼ˆWhyï¼‰

ã“ã®ã‚¢ãƒ—ãƒªã¯ã€
çŠ¬ã®æ•£æ­©çµŒè·¯ã‚’è¨˜éŒ²ãƒ»å¯è¦–åŒ–ã™ã‚‹ã“ã¨ã§ã€
å®¶æ—é–“ã§æ•£æ­©å±¥æ­´ã‚’å…±æœ‰ãƒ»æŒ¯ã‚Šè¿”ã‚Šã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã™ã‚‹ã€‚

---

## 2. ä¸»ãªæ©Ÿèƒ½ï¼ˆWhatï¼‰

- çŠ¬ã®æ•£æ­©çµŒè·¯ã®è¨˜éŒ²ï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å¯¾å¿œï¼‰
- æ•£æ­©çµŒè·¯ã®åœ°å›³è¡¨ç¤º
- é€±ãƒ»æœˆå˜ä½ã®çµ±è¨ˆæƒ…å ± / ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º
- å®¶æ—ï¼ˆã‚°ãƒ«ãƒ¼ãƒ—ï¼‰å˜ä½ã§ã®ãƒ‡ãƒ¼ã‚¿å…±æœ‰
- ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹åˆ©ç”¨åˆ¶é™ç®¡ç†
- ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ / ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†

---

## 3. ç”»é¢æ§‹æˆï¼ˆScreensï¼‰

### 3.1 èªè¨¼å‰ãƒ•ãƒ­ãƒ¼

#### ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢
- Firebase Authentication ã‚’ä½¿ç”¨
- ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ­ã‚°ã‚¤ãƒ³ã®ã¿å¯¾å¿œ
  - Google
  - Apple
- èªè¨¼ã•ã‚Œã¦ã„ãªã„å ´åˆã€ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã«å¿…ãšã“ã®ç”»é¢ã‚’è¡¨ç¤ºã™ã‚‹

---

### 3.2 èªè¨¼å¾Œãƒ»åˆå›ãƒ•ãƒ­ãƒ¼

#### ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ è¨­å®šç”»é¢
- ãƒ­ã‚°ã‚¤ãƒ³å¾Œã€æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å ´åˆã«è¡¨ç¤º
- ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã®å…¥åŠ›ãƒ»ç™»éŒ²ã‚’è¡Œã†
- ç™»éŒ²å®Œäº†å¾Œï¼š
  - é€šå¸¸ãƒ­ã‚°ã‚¤ãƒ³ï¼šãƒ›ãƒ¼ãƒ ç”»é¢ã¸
  - æ‹›å¾…ãƒªãƒ³ã‚¯çµŒç”±ï¼šå®¶æ—å‚åŠ å‡¦ç†å¾Œã«ãƒ›ãƒ¼ãƒ ç”»é¢ã¸

---

### 3.3 ãƒ­ã‚°ã‚¤ãƒ³å¾Œã®ç”»é¢æ§‹æˆï¼ˆãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªï¼‰

- ç”»é¢ä¸‹éƒ¨ã« **ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ãƒ–** ã‚’è¡¨ç¤º
- åˆæœŸè¡¨ç¤ºã‚¿ãƒ–ã¯ **ãƒ›ãƒ¼ãƒ **

#### ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ãƒ–ä¸€è¦§
1. ãƒ›ãƒ¼ãƒ 
2. åœ°å›³
3. çµ±è¨ˆ
4. è¨­å®š

---

## 4. å„ç”»é¢ã®è©³ç´°ä»•æ§˜

### 4.1 ãƒ›ãƒ¼ãƒ ç”»é¢
- ã‚¢ãƒ—ãƒªèµ·å‹•å¾Œã€æœ€åˆã«è¡¨ç¤ºã•ã‚Œã‚‹ç”»é¢
- æ•£æ­©ã® **è¨˜éŒ²é–‹å§‹ãƒœã‚¿ãƒ³** ã‚’é…ç½®
- è¨˜éŒ²ä¸­ / æœªè¨˜éŒ²ã®çŠ¶æ…‹ã«å¿œã˜ã¦ UI ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹

---

### 4.2 åœ°å›³ç”»é¢
- è¨˜éŒ²ã—ãŸæ•£æ­©ãƒ«ãƒ¼ãƒˆã‚’åœ°å›³ä¸Šã«è¡¨ç¤º
- 7æ—¥é–“å˜ä½ã§çµŒè·¯ã‚’è¡¨ç¤ºå¯èƒ½
- æ›œæ—¥ã”ã¨ã«è‰²åˆ†ã‘ã•ã‚ŒãŸçµŒè·¯ã‚’è¡¨ç¤ºã™ã‚‹

---

### 4.3 çµ±è¨ˆç”»é¢

#### æ§‹æˆ
- ç”»é¢ä¸Šéƒ¨ã«ã‚¿ãƒ–ã‚’é…ç½®
  - çµ±è¨ˆ
  - ãƒ©ãƒ³ã‚­ãƒ³ã‚°

#### çµ±è¨ˆã‚¿ãƒ–
- é›†è¨ˆå˜ä½ï¼š
  - é€±å˜ä½
  - æœˆå˜ä½
- è¡¨ç¤ºé …ç›®ï¼š
  - æ•£æ­©å›æ•°
  - ç·è·é›¢
  - å¹³å‡è·é›¢
  - å¹³å‡æ‰€è¦æ™‚é–“
- ä¸‹éƒ¨ã«æ•£æ­©è¨˜éŒ²ä¸€è¦§ã‚’è¡¨ç¤º
- è¨˜éŒ²ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ï¼š
  - æ•£æ­©çµŒè·¯ã‚’ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¡¨ç¤º

#### ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚¿ãƒ–
- å®¶æ—å†…ã®æ•£æ­©ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’è¡¨ç¤º
- ã‚½ãƒ¼ãƒˆåŸºæº–ï¼š
  - ç·è·é›¢ï¼ˆé™é †ï¼‰
- è¡¨ç¤ºå†…å®¹ï¼š
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼å
  - ç·è·é›¢
  - é †ä½ã‚¢ã‚¤ã‚³ãƒ³
    - ğŸ¥‡ 1ä½ï¼šé‡‘ãƒ¡ãƒ€ãƒ«
    - ğŸ¥ˆ 2ä½ï¼šéŠ€ãƒ¡ãƒ€ãƒ«
    - ğŸ¥‰ 3ä½ï¼šéŠ…ãƒ¡ãƒ€ãƒ«

---

### 4.4 è¨­å®šç”»é¢

#### è¡¨ç¤ºå†…å®¹
- ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ï¼ˆãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç”»é¢ã¸ã®å°ç·šï¼‰
- ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æƒ…å ±
  - ã‚ªãƒ¼ãƒŠãƒ¼ã®ã¿è¡¨ç¤º
  - ã‚µãƒ–ã‚¹ã‚¯è³¼å…¥ç”»é¢ã¸ã®é·ç§»
- å®¶æ—ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§
- æ‹›å¾…ãƒªãƒ³ã‚¯ä½œæˆãƒœã‚¿ãƒ³ï¼ˆã‚ªãƒ¼ãƒŠãƒ¼ã®ã¿ï¼‰

â€» å€‹äººæ“ä½œï¼ˆãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒ»å‰Šé™¤ç­‰ï¼‰ã¯æœ¬ç”»é¢ã§ã¯è¡Œã‚ãªã„

---

### 4.5 ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç”»é¢

- è¨­å®šç”»é¢ã®ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã€ã‹ã‚‰é·ç§»ã™ã‚‹
- ãƒ¦ãƒ¼ã‚¶ãƒ¼æœ¬äººã«é–¢ã™ã‚‹æ“ä½œã‚’è¡Œã†ç”»é¢

#### å¯èƒ½ãªæ“ä½œ
- ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã®æ›´æ–°
- ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤

---

### 4.6 ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³è³¼å…¥ç”»é¢

- ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®è³¼å…¥ãŒå¯èƒ½
- ãƒ—ãƒ©ãƒ³ï¼š
  - æœˆé¡ï¼š100å††
  - å¹´é¡ï¼š1000å††
- è‡ªå‹•æ›´æ–°ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³

#### è³¼å…¥å¾Œã®æŒ™å‹•
- è³¼å…¥å®Œäº†å¾Œï¼š
  - ã‚¢ãƒ—ãƒªã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ä¿ƒã™ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º
- è³¼å…¥å®Œäº†å¾Œã¯è‡ªå‹•çš„ã«ã‚¢ãƒ—ãƒªã«æˆ»ã‚‹

---

## 5. ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã¨åˆ¶å¾¡ãƒ«ãƒ¼ãƒ«

- èªè¨¼å‰ï¼š
  - ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã®ã¿è¡¨ç¤º
- èªè¨¼å¾Œãƒ»æœªãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ è¨­å®šï¼š
  - ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ è¨­å®šç”»é¢ã®ã¿è¡¨ç¤º
- èªè¨¼å¾Œãƒ»é€šå¸¸çŠ¶æ…‹ï¼š
  - ãƒ¡ã‚¤ãƒ³ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
- èª­ã¿å–ã‚Šå°‚ç”¨çŠ¶æ…‹ï¼š
  - ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã¯è¡¨ç¤ºã™ã‚‹
  - è¨˜éŒ²é–‹å§‹ãƒ»ç·¨é›†ç³»æ“ä½œã¯ç„¡åŠ¹åŒ–ã™ã‚‹

---

## 6. å°†æ¥çš„ã«å¯¾å¿œäºˆå®šã®æ‹¡å¼µï¼ˆæœ¬ä»•æ§˜ã§ã¯æœªå®Ÿè£…ï¼‰

- ã‚ªãƒ¼ãƒŠãƒ¼ã®å¤‰æ›´
- å®¶æ—ãƒ¡ãƒ³ãƒãƒ¼ã®å‰Šé™¤ï¼ˆã‚­ãƒƒã‚¯ã‚¢ã‚¦ãƒˆï¼‰
- æ¨©é™ç®¡ç†ã®ç´°åˆ†åŒ–
- æ•£æ­©ãƒ‡ãƒ¼ã‚¿ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- é€šçŸ¥æ©Ÿèƒ½

---

## 7. æ˜ç¤ºçš„ã«ã‚„ã‚‰ãªã„ã“ã¨ï¼ˆã‚¹ã‚³ãƒ¼ãƒ—å¤–ï¼‰

- SNSæ©Ÿèƒ½ï¼ˆãƒ•ã‚©ãƒ­ãƒ¼ãƒ»å…¬é–‹æŠ•ç¨¿ï¼‰
- Webç‰ˆã‚¢ãƒ—ãƒª
- å¤šè¨€èªå¯¾å¿œ
- çŠ¬ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®è©³ç´°ç®¡ç†

---

## 8. ç”¨èªå®šç¾©

| ç”¨èª | æ„å‘³ |
|---|---|
| ã‚ªãƒ¼ãƒŠãƒ¼ | å®¶æ—ã‚’ä½œæˆã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ |
| å®¶æ— | ãƒ‡ãƒ¼ã‚¿å…±æœ‰ã‚°ãƒ«ãƒ¼ãƒ— |
| èª­ã¿å–ã‚Šå°‚ç”¨ | é–²è¦§ã®ã¿å¯èƒ½ãªçŠ¶æ…‹ |
| Trial | ã‚¢ãƒ—ãƒªå†…ãŠè©¦ã—æœŸé–“ |

---

## 9. æ‹›å¾…ãƒªãƒ³ã‚¯æ©Ÿèƒ½ï¼ˆå€‹äººé–‹ç™ºå‘ã‘ã‚·ãƒ³ãƒ—ãƒ«æ§‹æˆï¼‰

### 9.1 è¨­è¨ˆæ–¹é‡

æœ¬ã‚¢ãƒ—ãƒªã®æ‹›å¾…ãƒªãƒ³ã‚¯æ©Ÿèƒ½ã¯ã€**å€‹äººé–‹ç™ºè¦æ¨¡**ã‚’å‰æã¨ã—ã€ä»¥ä¸‹ã‚’é‡è¦–ã™ã‚‹ï¼š

- **å®Ÿè£…ã®ç°¡æ½”ã•**: ã‚¢ãƒ—ãƒª + Firestore ã®ã¿ã§å®Œçµ
- **ã‚³ã‚¹ãƒˆã‚¼ãƒ­**: Cloud Functions ä¸ä½¿ç”¨
- **å°†æ¥ã®æ‹¡å¼µä½™åœ°**: å¿…è¦ã«å¿œã˜ã¦é«˜åº¦åŒ–å¯èƒ½ãªè¨­è¨ˆ

---

### 9.2 æ‹›å¾…ãƒªãƒ³ã‚¯ã®ç›®çš„

- å®¶æ—ï¼ˆã‚°ãƒ«ãƒ¼ãƒ—ï¼‰ã«æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‚åŠ ã•ã›ã‚‹
- å®¶æ—ã‚ªãƒ¼ãƒŠãƒ¼ãŒæ‹›å¾…æ“ä½œã‚’è¡Œã†
- æ‹›å¾…ãƒªãƒ³ã‚¯ã¯ **1å›é™ã‚Šã®ä½¿ã„æ¨ã¦**

---

### 9.3 æ‹›å¾…ãƒªãƒ³ã‚¯ã®æ§‹é€ 

#### Deep Link å½¢å¼
```
pawpath://invite?token={token}
```

- `token`: Firestore ã® `invites` ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆID
- ã‚¢ãƒ—ãƒªãŒç›´æ¥ Deep Link ã‚’ç”Ÿæˆãƒ»å…±æœ‰ã™ã‚‹

---

### 9.4 Firestore ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

#### invites ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³

```typescript
invites/{token}
{
  token: string        // ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆIDï¼ˆUUIDv4ï¼‰
  familyId: string     // æ‹›å¾…å…ˆã®å®¶æ—ID
  createdBy: string    // æ‹›å¾…ã‚’ä½œæˆã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ID
  createdAt: Timestamp // ä½œæˆæ—¥æ™‚
  expiresAt: Timestamp // æœ‰åŠ¹æœŸé™ï¼ˆ24æ™‚é–“å¾Œï¼‰
  isActive: boolean    // æœ‰åŠ¹ãƒ•ãƒ©ã‚°ï¼ˆtrue: æœªä½¿ç”¨, false: ä½¿ç”¨æ¸ˆã¿ï¼‰
}
```

**é‡è¦äº‹é …**:
- `token` = ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆIDï¼ˆçµ±ä¸€ï¼‰
- `isActive: false` ã«ãªã‚‹ã¨å†åˆ©ç”¨ä¸å¯
- Security Rules ã§æ›´æ–°åˆ¶å¾¡ã‚’è¡Œã†

---

### 9.5 æ‹›å¾…ãƒªãƒ³ã‚¯ä½œæˆãƒ•ãƒ­ãƒ¼

1. ã‚ªãƒ¼ãƒŠãƒ¼ãŒã€Œå®¶æ—ã‚’æ‹›å¾…ã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—
2. ã‚¢ãƒ—ãƒªãŒ Firestore ã« `invites` ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä½œæˆ
   - `token`: UUIDv4 ã‚’ç”Ÿæˆ
   - `isActive: true`
   - `expiresAt`: ç¾åœ¨æ™‚åˆ» + 24æ™‚é–“
3. Deep Link ã‚’ç”Ÿæˆ: `pawpath://invite?token={token}`
4. OS ã®å…±æœ‰ UIï¼ˆShare Sheetï¼‰ã§ãƒªãƒ³ã‚¯ã‚’é€ä¿¡

**å®Ÿè£…å ´æ‰€**:
- Service: `InviteService.createInvite()`
- Repository: `InviteRepository.create(invite)`

---

### 9.6 æ‹›å¾…ãƒªãƒ³ã‚¯åˆ©ç”¨ãƒ•ãƒ­ãƒ¼

1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ‹›å¾…ãƒªãƒ³ã‚¯ã‚’ã‚¿ãƒƒãƒ—
2. ã‚¢ãƒ—ãƒªãŒ Deep Link ã‹ã‚‰ `token` ã‚’å–å¾—
3. Firestore ã‹ã‚‰ `invites/{token}` ã‚’å–å¾—
4. ä»¥ä¸‹ã‚’ç¢ºèªï¼š
   - invite ãŒå­˜åœ¨ã™ã‚‹
   - `isActive === true`
   - `expiresAt > ç¾åœ¨æ™‚åˆ»`
5. ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ è¨­å®šç”»é¢ã‚’è¡¨ç¤º
6. ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ è¨­å®šå®Œäº†å¾Œï¼š
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ `familyId` ã«å‚åŠ ã•ã›ã‚‹
   - `invites/{token}.isActive = false` ã«æ›´æ–°
7. ãƒ›ãƒ¼ãƒ ç”»é¢ã¸é·ç§»

**å®Ÿè£…å ´æ‰€**:
- Service: `InviteService.acceptInvite(token, nickname)`
- Repository: `InviteRepository.joinByInvite(invite, userId, nickname)`

---

### 9.7 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ–¹é‡

#### Firestore Security Rules ã§åˆ¶å¾¡

```javascript
// invites ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
match /invites/{inviteId} {
  // èª­ã¿å–ã‚Š: å…¨å“¡å¯èƒ½ï¼ˆæ‹›å¾…ãƒªãƒ³ã‚¯ã®æ¤œè¨¼ç”¨ï¼‰
  allow read: if true;
  
  // ä½œæˆ: ã‚ªãƒ¼ãƒŠãƒ¼ã®ã¿
  allow create: if request.auth != null
    && request.resource.data.createdBy == request.auth.uid
    && exists(/databases/$(database)/documents/users/$(request.auth.uid))
    && get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'owner';
  
  // æ›´æ–°: isActive ã‚’ false ã«ã™ã‚‹æ“ä½œã®ã¿è¨±å¯
  allow update: if request.auth != null
    && resource.data.isActive == true
    && request.resource.data.isActive == false
    && request.resource.data.diff(resource.data).affectedKeys().hasOnly(['isActive']);
}
```

**ãƒã‚¤ãƒ³ãƒˆ**:
- `isActive: true â†’ false` ã®ã¿è¨±å¯
- å†åˆ©ç”¨ãƒ»ä¸Šæ›¸ãã¯ç¦æ­¢

---

### 9.8 åˆ¶ç´„ãƒ»å‰²ã‚Šåˆ‡ã‚Šäº‹é …

å€‹äººé–‹ç™ºè¦æ¨¡ã®ãŸã‚ã€ä»¥ä¸‹ã¯ **ç¾æ™‚ç‚¹ã§ã¯å¯¾å¿œã—ãªã„**ï¼š

- æ‹›å¾…ãƒªãƒ³ã‚¯ã®é€”ä¸­ã‚­ãƒ£ãƒ³ã‚»ãƒ«
- åŒæ™‚ä½¿ç”¨ã«ã‚ˆã‚‹ç«¶åˆå¯¾ç­–ï¼ˆæ¥½è¦³çš„ãƒ­ãƒƒã‚¯ç­‰ï¼‰
- è©³ç´°ãªç›£æŸ»ãƒ­ã‚°ãƒ»ä¸æ­£å¯¾ç­–
- æ‹›å¾…å›æ•°ã®ä¸Šé™ç®¡ç†

ã“ã‚Œã‚‰ã¯ **å°†æ¥çš„ã« Cloud Functions ã‚’å°å…¥ã™ã‚‹ã“ã¨ã§å¯¾å¿œå¯èƒ½**ã€‚

---

### 9.9 å°†æ¥æ‹¡å¼µã®ä½™åœ°

ç¾åœ¨ã¯ã‚¢ãƒ—ãƒª + Firestore ã®ã¿ã§å®Ÿè£…ã—ã¦ã„ã‚‹ãŒã€
å¿…è¦ã«å¿œã˜ã¦ä»¥ä¸‹ã‚’è¿½åŠ å¯èƒ½ï¼š

- **Cloud Functions ã¸ã®ç§»è¡Œ**
  - ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ä¿è¨¼ã®å¼·åŒ–
  - æ‹›å¾…ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†ï¼ˆpending / used / expiredï¼‰
  - è©³ç´°ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- **æ‹›å¾…ãƒªãƒ³ã‚¯ã®é«˜åº¦åŒ–**
  - è¤‡æ•°å›ä½¿ç”¨å¯èƒ½ãªæ‹›å¾…ãƒªãƒ³ã‚¯
  - æœ‰åŠ¹æœŸé™ã®æŸ”è»Ÿãªè¨­å®š
  - æ‹›å¾…å±¥æ­´ã®ç®¡ç†

**ç¾æ™‚ç‚¹ã§ã¯ã‚·ãƒ³ãƒ—ãƒ«ã•ã‚’å„ªå…ˆã—ã€å¿…è¦æ€§ãŒæ˜ç¢ºã«ãªã£ã¦ã‹ã‚‰æ‹¡å¼µã™ã‚‹**ã€‚

---