# 犬の散歩記録アプリ 仕様書（spec.md）

## 0. この仕様書の前提（AI向け）
この仕様書は「完全なクリーンアーキテクチャ」ではなく、
個人開発向けの「クリーンな責務分離」を前提とする。

- UI → Context → Service → Repository の構成を守る
- Context に業務ロジックを書かない
- 不明点は勝手に補完せず、設計案を提示すること

---

## 1. アプリ概要（Why）

このアプリは、
犬の散歩経路を記録・可視化することで、
家族間で散歩履歴を共有・振り返りできるようにすることを目的とする。

---

## 2. 主な機能（What）

- 犬の散歩経路の記録（バックグラウンド対応）
- 散歩経路の地図表示
- 週・月単位の統計情報 / ランキング表示
- 家族（グループ）単位でのデータ共有
- サブスクリプションによる利用制限管理
- ログアウト / アカウント削除
- ユーザープロファイル管理

---

## 3. 画面構成（Screens）

### 3.1 認証前フロー

#### ログイン画面
- Firebase Authentication を使用
- ソーシャルログインのみ対応
  - Google
  - Apple
- 認証されていない場合、アプリ起動時に必ずこの画面を表示する

---

### 3.2 認証後・初回フロー

#### ニックネーム設定画面
- ログイン後、新規ユーザーの場合に表示
- ニックネームの入力・登録を行う
- 登録完了後：
  - 通常ログイン：ホーム画面へ
  - 招待リンク経由：家族参加処理後にホーム画面へ

---

### 3.3 ログイン後の画面構成（メインアプリ）

- 画面下部に **ナビゲーションタブ** を表示
- 初期表示タブは **ホーム**

#### ナビゲーションタブ一覧
1. ホーム
2. 地図
3. 統計
4. 設定

---

## 4. 各画面の詳細仕様

### 4.1 ホーム画面
- アプリ起動後、最初に表示される画面
- 散歩の **記録開始ボタン** を配置
- 記録中 / 未記録の状態に応じて UI を切り替える

---

### 4.2 地図画面
- 記録した散歩ルートを地図上に表示
- 7日間単位で経路を表示可能
- 曜日ごとに色分けされた経路を表示する

---

### 4.3 統計画面

#### 構成
- 画面上部にタブを配置
  - 統計
  - ランキング

#### 統計タブ
- 集計単位：
  - 週単位
  - 月単位
- 表示項目：
  - 散歩回数
  - 総距離
  - 平均距離
  - 平均所要時間
- 下部に散歩記録一覧を表示
- 記録をタップすると：
  - 散歩経路をアニメーション表示

#### ランキングタブ
- 家族内の散歩ランキングを表示
- ソート基準：
  - 総距離（降順）
- 表示内容：
  - ユーザー名
  - 総距離
  - 順位アイコン
    - 🥇 1位：金メダル
    - 🥈 2位：銀メダル
    - 🥉 3位：銅メダル

---

### 4.4 設定画面

#### 表示内容
- ユーザー情報（プロファイル画面への導線）
- サブスクリプション情報
  - オーナーのみ表示
  - サブスク購入画面への遷移
- 家族メンバー一覧
- 招待リンク作成ボタン（オーナーのみ）

※ 個人操作（ログアウト・削除等）は本画面では行わない

---

### 4.5 ユーザープロファイル画面

- 設定画面の「ユーザー情報」から遷移する
- ユーザー本人に関する操作を行う画面

#### 可能な操作
- ニックネームの更新
- ログアウト
- アカウント削除

---

### 4.6 サブスクリプション購入画面

- サブスクリプションの購入が可能
- プラン：
  - 月額：100円
  - 年額：1000円
- 自動更新サブスクリプション

#### 購入後の挙動
- 購入完了後：
  - アプリのレビューを促すダイアログを表示
- 購入完了後は自動的にアプリに戻る

---

## 5. ナビゲーションと制御ルール

- 認証前：
  - ログイン画面のみ表示
- 認証後・未ニックネーム設定：
  - ニックネーム設定画面のみ表示
- 認証後・通常状態：
  - メインナビゲーションを表示
- 読み取り専用状態：
  - ナビゲーションは表示する
  - 記録開始・編集系操作は無効化する

---

## 6. 将来的に対応予定の拡張（本仕様では未実装）

- オーナーの変更
- 家族メンバーの削除（キックアウト）
- 権限管理の細分化
- 散歩データのエクスポート
- 通知機能

---

## 7. 明示的にやらないこと（スコープ外）

- SNS機能（フォロー・公開投稿）
- Web版アプリ
- 多言語対応
- 犬プロフィールの詳細管理

---

## 8. 用語定義

| 用語 | 意味 |
|---|---|
| オーナー | 家族を作成したユーザー |
| 家族 | データ共有グループ |
| 読み取り専用 | 閲覧のみ可能な状態 |
| Trial | アプリ内お試し期間 |

---